#include <Arduino.h>
#include <Scheduler.h>
#include <Task.h>
#include <ArduinoOTA.h>
#include "IRsender.h"
#include "OTATask.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const char *ssid = "IOT_DEVICES";
const char *password = "iot_lab_devices";

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

OTATask* tOTATask;
Attendance* tAtendance;
IRsender* tIRsender;

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void setup() {
  Serial.begin(115200);
  Serial.println("");
   WiFi.begin(ssid, password);


   setup_ota(); 

  tOTATask = new OTATask(true);
  Scheduler.start(tOTATask);

  tAtendance = new Attendance(true);
  Scheduler.start(tAtendance);

  tIRsender = new IRsender(true);
  Scheduler.start(tIRsender);



  Scheduler.begin();
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void loop() {
  // don`t add anything here 
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void setup_ota() {
  ArduinoOTA.setHostname("esp8266-scheduler");
  ArduinoOTA.onStart([]() {
    Serial.println("OTA Start");
  });
  
  ArduinoOTA.onEnd([]() {
    Serial.println("OTA End");
  });
  
  ArduinoOTA.onProgress([](unsigned int progress, unsigned int total) {
    Serial.printf("OTA Progress: %u%%\r", (progress / (total / 100)));
  });
  
  ArduinoOTA.begin();
}
